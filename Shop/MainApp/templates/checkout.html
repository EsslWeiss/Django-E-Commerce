{% extends 'index.html' %}
{% load crispy_forms_tags %}

{% block content %}

<h3 class="text-center mt-5 mb-5">Оформление заказа</h3>

<table class="table mt-4">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Наименование</th>
      <th scope="col">Изоборажение</th>
      <th scope="col">Цена</th>
      <th scope="col">Кол-во</th>
      <th scope="col">Общая цена</th>
    </tr>
  </thead>
  <tbody>

  	{% for product in cart.products.all %}
	    <tr>
	      <td>{{ product.content_object.name }}</td>
	      <td class="w-25"><img src="{{ product.content_object.image.url }}" class="img-fluid"></td>
	      <td>{{ product.content_object.price }}$</td>
	      
	      <td>{{ product.quantity }}</td>
	      
	      <td>{{ product.full_price }}$</td>

	    </tr>
	{% endfor %}

		<tr>
			<td colspan="2"></td>
			<td><strong>Итого</strong></td>
			<td><strong>{{ cart.total_products }}</strong></td>
			<td><strong>{{ cart.final_price }}$</strong></td>

		</tr>

  </tbody>
</table>
<hr>
<h3 class="text-center mt-5 mb-5"><strong>Форма заказа</strong></h3>

<div class="row">
	<div class="col-md-6">
		<h3 class="text-center">Оформить заказ</h3>
		<form action="{% url 'MakeOrderView' %}" method="POST">
			{% csrf_token %}

			{{ form|crispy }}

			<input type="submit" class="btn btn-success btn-block mb-5" value="Оформить заказ">
		</form>
	</div>

	<div class="col-md-6">
		<h3 class="text-center">Оплатить с помощью карты</h3>
		<form id="payment-form">
		  <div id="card-element">
		    <!-- Elements will create input elements here -->
		  </div>

		  <!-- We'll put the error messages in this element -->
		  <div id="card-errors" role="alert"></div>

		  <button id="submit" data-secret={{ client_secret }}>Pay</button>
		</form>
	</div>
</div>

{% endblock content %}